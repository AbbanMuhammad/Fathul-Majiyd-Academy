<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>School's Dictionary</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #301934;
    }
    .dictionary-card {
      max-width: 600px;
      margin: 40px auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(80, 0, 100, 0.08);
      padding: 32px 24px;
    }
    .dictionary-title {
      font-weight: 700;
      color: #7e097b;
      text-align: center;
      margin-bottom: 1rem;
    }
    .phonetic {
      font-style: italic;
      color: #666;
    }
    .part-of-speech {
      font-weight: bold;
      color: #007bff;
      margin-top: 10px;
      margin-bottom: 5px;
    }
    .definition-item {
      margin-left: 20px;
      margin-bottom: 5px;
    }
    .example {
      font-style: italic;
      color: #555;
      margin-left: 20px;
      margin-top: 2px;
    }
    .synonyms, .antonyms {
      font-size: 0.95em;
      color: #777;
      margin-top: 5px;
      margin-left: 20px;
    }
    .error {
      color: red;
      font-weight: bold;
      margin-top: 16px;
    }
    @media (max-width: 576px) {
      .dictionary-card {
        padding: 16px 5px;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #7e097b;">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">
        <img src="./assets/logo.png" alt="School Logo" style="height:38px;" class="me-2 align-middle">
        Fathul Majiyd Academy
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#">About Us</a></li>
          <li class="nav-item"><a class="nav-link" href="academic.html">Academic</a></li>
          <li class="nav-item"><a class="nav-link" href="admission.html">Admission</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Events</a></li>
          <li class="nav-item"><a class="nav-link" href="articles.html">Articles</a></li>
          <li class="nav-item"><a class="nav-link active" href="dictionary.html">Dictionary</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="dictionary-card">
    <h1 class="dictionary-title">School's Dictionary</h1>
    <p class="text-center mb-4">Enter a word to find its definition, phonetics, usages and more.</p>
    <div class="input-group mb-3">
      <input type="text" class="form-control" id="wordInput" placeholder="Enter a word" />
      <button class="btn btn-primary" style="background:#7e097b;" id="searchBtn">Search</button>
    </div>
    <div id="results">
      <p class="text-muted text-center">Start by searching for a word in this dictionary.</p>
    </div>
  </div>

  <footer class="bg-dark text-white text-center py-4 mt-5">
    <div class="container">
      <p class="mb-0">&copy; Fathul Majiyd Academy</p>
    </div>
  </footer>

  <script>
    // Utility: escape HTML to avoid inserting raw user/API text into the DOM
    function escapeHtml(str) {
      if (!str && str !== 0) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;')
        .replace(/`/g, '&#96;');
    }

    // Attach events
    document.getElementById('searchBtn').addEventListener('click', searchWord);
    document.getElementById('wordInput').addEventListener('keydown', function (e) {
      if (e.key === 'Enter') searchWord();
    });

    async function searchWord() {
      const inputEl = document.getElementById("wordInput");
      const wordInput = inputEl.value.trim();
      const resultsDiv = document.getElementById("results");

      if (!wordInput) {
        resultsDiv.innerHTML = '<p class="error">Please enter a word to search.</p>';
        return;
      }

      // Show loading
      resultsDiv.innerHTML = '<div class="text-center"><span class="spinner-border text-primary" role="status" aria-hidden="true"></span> Loading...</div>';

      // Encode the input so spaces and special characters won't break the URL
      const safeWord = encodeURIComponent(wordInput.toLowerCase());
      const apiUrl = `https://api.dictionaryapi.dev/api/v2/entries/en/${safeWord}`;

      try {
        console.log('Fetching dictionary API for:', wordInput, 'URL:', apiUrl);
        const response = await fetch(apiUrl);

        console.log('Response status:', response.status);

        if (!response.ok) {
          // Attempt to parse returned error JSON for a better message
          let errText = `An error occurred: ${response.status}`;
          try {
            const errJson = await response.json();
            if (errJson && errJson.title) {
              errText = `${errJson.title}${errJson.message ? ': ' + errJson.message : ''}`;
            } else if (errJson && errJson.message) {
              errText = errJson.message;
            }
          } catch (parseErr) {
            console.warn('Could not parse error JSON', parseErr);
          }

          if (response.status === 404) {
            resultsDiv.innerHTML = `<p class="error">No definitions found for "${escapeHtml(wordInput)}". Please check your spelling.</p>`;
          } else {
            resultsDiv.innerHTML = `<p class="error">${escapeHtml(errText)}</p>`;
          }
          return;
        }

        const data = await response.json();
        console.log('Dictionary API data:', data);
        displayResults(data);
      } catch (error) {
        resultsDiv.innerHTML = `<p class="error">Could not connect to the dictionary service. Please try again later.</p>`;
        console.error("Fetch error:", error);
      }
    }

    function displayResults(data) {
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = ""; // Clear previous results

      if (!data || data.length === 0) {
        resultsDiv.innerHTML = '<p class="error">No definitions found.</p>';
        return;
      }

      const entry = data[0];
      let html = `<div class="word-title h3">${escapeHtml(entry.word || '')}</div>`;

      // Phonetics
      if (entry.phonetics && entry.phonetics.length > 0) {
        const textPhonetic = entry.phonetics.find(p => p.text && p.text.trim())?.text;
        const audioPhonetic = entry.phonetics.find(p => p.audio && p.audio.trim())?.audio;

        if (textPhonetic) {
          html += `<div class="phonetic mb-2">${escapeHtml(textPhonetic)}</div>`;
        }
        if (audioPhonetic) {
          // Some audio URLs may be relative or empty; ensure it's a string
          html += `<div class="mb-2"><audio controls src="${escapeHtml(audioPhonetic)}"></audio></div>`;
        }
      }

      // Meanings and definitions
      if (entry.meanings && entry.meanings.length > 0) {
        entry.meanings.forEach(meaning => {
          html += `<div class="meaning-section mb-3">`;
          html += `<div class="part-of-speech">${escapeHtml(meaning.partOfSpeech || '')}</div>`;

          if (meaning.definitions && meaning.definitions.length > 0) {
            meaning.definitions.forEach((def, index) => {
              html += `<div class="definition-item">${index + 1}. ${escapeHtml(def.definition || '')}</div>`;
              if (def.example) {
                html += `<div class="example">"${escapeHtml(def.example)}"</div>`;
              }
              // Some API entries include synonyms/antonyms at definition-level
              if (def.synonyms && def.synonyms.length > 0) {
                html += `<div class="synonyms"><strong>Synonyms:</strong> ${def.synonyms.map(s => escapeHtml(s)).join(", ")}</div>`;
              }
              if (def.antonyms && def.antonyms.length > 0) {
                html += `<div class="antonyms"><strong>Antonyms:</strong> ${def.antonyms.map(a => escapeHtml(a)).join(", ")}</div>`;
              }
            });
          }

          // Meaning-level synonyms/antonyms
          if (meaning.synonyms && meaning.synonyms.length > 0) {
            html += `<div class="synonyms"><strong>Synonyms:</strong> ${meaning.synonyms.map(s => escapeHtml(s)).join(", ")}</div>`;
          }
          if (meaning.antonyms && meaning.antonyms.length > 0) {
            html += `<div class="antonyms"><strong>Antonyms:</strong> ${meaning.antonyms.map(a => escapeHtml(a)).join(", ")}</div>`;
          }
          html += `</div>`;
        });
      } else {
        html += "<p>No meanings found for this word.</p>";
      }

      resultsDiv.innerHTML = html;
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>